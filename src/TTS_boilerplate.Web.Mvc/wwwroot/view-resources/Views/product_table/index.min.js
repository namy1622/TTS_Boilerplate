"use strict";(function(n){function o(n,i){abp.message.confirm(abp.utils.formatString(f("AreYouSureWantToDelete"),i),null,function(i){i&&u.deleteProduct(n).done(function(){abp.notify.info(f("SuccessfullyDeleted"));t.ajax.reload()})})}function s(){n("#creationDate_1").daterangepicker({timePicker:!0,singleDatePicker:!0,showDropdowns:!0,locale:{format:"YYYY-MM-DD HH:mm",applyLabel:"Áp dụng",cancelLabel:"Hủy",daysOfWeek:["CN","T2","T3","T4","T5","T6","T7"],monthNames:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"]}});n("#expirationDate_1").daterangepicker({timePicker:!0,singleDatePicker:!0,showDropdowns:!0,locale:{format:"YYYY-MM-DD HH:mm",applyLabel:"Áp dụng",cancelLabel:"Hủy",daysOfWeek:["CN","T2","T3","T4","T5","T6","T7"],monthNames:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"]}})}function h(){n("#creationDate").daterangepicker({timePicker:!0,singleDatePicker:!0,showDropdowns:!0,locale:{format:"YYYY-MM-DD HH:mm",applyLabel:"Áp dụng",cancelLabel:"Hủy",daysOfWeek:["CN","T2","T3","T4","T5","T6","T7"],monthNames:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"]}});n("#expirationDate").daterangepicker({timePicker:!0,singleDatePicker:!0,showDropdowns:!0,locale:{format:"YYYY-MM-DD HH:mm",applyLabel:"Áp dụng",cancelLabel:"Hủy",daysOfWeek:["CN","T2","T3","T4","T5","T6","T7"],monthNames:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"]}})}var t;console.log("index.js has been loaded");var u=abp.services.app.product_table,f=abp.localization.getSource("TTS_boilerplate"),i=n("#ProductCreateModal"),r=i.find("form"),e=n("#ProductsTable");console.log("log 1 ",u);console.log(abp.services.app);t=e.DataTable({paging:!0,serverSide:!0,processing:!0,ordering:!0,listAction:{ajaxFunction:u.getAllProductCategory,inputFilter:function(){var i=n("#ProductsSearchForm").serializeFormToObject(!0),r;console.log("-- 1 --",u.getAllProductCategory);var c=t?t.settings()[0].oAjaxData.draw:1,f=t?t.settings()[0]._iDisplayStart:0,e=t?t.settings()[0]._iDisplayLength:10;if(i.skipCount=f,i.maxResultCount=e,r=t?t.order():[[1,"asc"]],console.log("-- order",r),r&&r.length>0){var o=r[0][0],s=r[0][1],h=t?t.settings()[0].aoColumns[o].name:1;i.sorting=h+" "+s}else i.sorting="";return console.log("-- Form data:",i),i}},buttons:[{name:"refresh",text:'<i class=" fas fa-redo-alt"><\/i>',action:function(){return t.draw(!1)}}],responsive:{details:{type:"column"}},columnDefs:[{targets:0,className:"control",defaultContent:"",orderable:!1},{targets:1,data:"nameProduct",name:"NameProduct",sortable:!0},{targets:2,data:"descriptionProduct",name:"DesciptionProduct",sortable:!1},{targets:3,data:"price",name:"Price",sortable:!0,render:function(n){return Number(n).toLocaleString("vi-VN")+"đ"}},{targets:4,data:"creationDate",name:"CreationDate",sortable:!0,render:function(n){return n&&moment(n).isValid()?moment(n).format("YYYY-MM-DD HH:mm"):""}},{targets:5,data:"expirationDate",name:"ExpirationDate",sortable:!0,render:function(n){return n&&moment(n).isValid()?moment(n).format("YYYY-MM-DD HH:mm"):""}},{targets:6,data:"nameCategory",name:"NameCategory",sortable:!1,render:function(n){return n?n:"N/A"}},{targets:7,data:"productImagePath",sortable:!1,render:function(n){return n?'<img src="'+n+'" alt="image" \n                                class=""\n                                style="width: 50px; height: 50px; border-radius: 8px; object-fit: cover;"\n                            />':""}},{targets:8,data:null,sortable:!1,autoWidth:!1,defaultContent:"",render:function(n,t,i){return console.log(i),['<div class="d-flex flex-column ml-2">','<button type="button" style="width:32px; height:28px; " title="Update" class="btn btn-sm bg-secondary  edit-product mr-1" data-product-id="'+i.id+'" data-toggle="modal" data-target="#ProductEditModal">','   <i class="fas fa-pencil-alt "><\/i> ',"<\/button>",'<button type="button" style="width:32px ; height:28px;" title="Delete" class="btn btn-sm bg-danger delete-product mt-1" data-product-id="'+i.id+'" data-product-name="'+i.nameProduct+'" >','   <i class="fas fa-trash"><\/i> ',"<\/button>","<\/div>"].join("")}}]});n("#searchKeyword").on("input",function(){t.draw()});n(document).on("click",".edit-product",function(t){var i=n(this).attr("data-product-id");console.log("id",i);t.preventDefault();console.log(abp.appPath+"Products_table/EditProduct?productId="+i);abp.ajax({url:abp.appPath+"Products_table/EditProduct?productId="+i,type:"POST",dataType:"html",success:function(t){if(!t||t.trim()===""){console.error("Lỗi: Nội dung trả về trống!");return}n("#ProductEditModal div.modal-content").html(t);console.log("sau html(content)","");console.log("-- category",n("#categorySelect").val());s()},error:function(n){console.log("error",n)}})});abp.event.on("product.edited",function(){t.ajax.reload()});n(document).on("click",".delete-product",function(){var i=n(this).attr("data-product-id"),t;console.log("id_product",i);t=n(this).attr("data-product-name");console.log("name_product",t);o(i,t)});i.on("shown.bs.modal",function(){h()});r.find(".save-button").on("click",function(u){var e,s,o,v,c;if(u.preventDefault(),r.valid()){e=new FormData(r[0]);console.log("CreationDate before send:",e.get("CreationDate"));console.log("ExpirationDate before send:",e.get("ExpirationDate"));console.log("product.categoryId ",e.categoryId);s=parseInt(n("#categorySelect").val());console.log("--Selected category_create: ",s);e.append("CategoryId",s);console.log("formData to send:");var h=!0,l=!1,a=undefined;try{for(o=e.entries()[Symbol.iterator]();!(h=(v=o.next()).done);h=!0)c=v.value,console.log(c[0]+": "+c[1])}catch(y){l=!0;a=y}finally{try{!h&&o["return"]&&o["return"]()}finally{if(l)throw a;}}console.log("abp.appPath:",abp.appPath);abp.ui.setBusy(i);n.ajax({url:abp.appPath+"Products_table/CreateProduct",type:"POST",data:e,contentType:!1,processData:!1,success:function(n){console.log("success",n);i.modal("hide");r[0].reset();abp.notify.info(f("Tạo mới thành công!"));t.ajax.reload()},error:function(n){console.error("Error details:",n);console.log("Status:",n.status);abp.notify.error(n.responseJSON.message||"An error occurred")},complete:function(){abp.ui.clearBusy(i)}})}});i.on("shown.bs.modal",function(){console.log("focus input form");i.find("input:not([type=hidden]):first").focus()}).on("hidden.bs.modal",function(){r.clearForm()});n('input[name="category"]').on("change",function(){var t=[];n('input[name="category"]:checked').each(function(){t.push(n(this).val())});n("#nameCategoryLabel").text(t.join(", "))});n(".btn-search").on("click",function(n){console.log("search click",n);t.ajax.reload()});n(".txt-search").on("keypress",function(n){if(n.which==13)return console.log("search keypress",n),t.ajax.reload(),console.log("end search keypress",n),!1});n("#ProductCreateModal #imgProduct").on("change",function(){var t=new FileReader;t.onload=function(t){n("#ProductCreateModal #imagePreview").attr("src",t.target.result).show()};t.readAsDataURL(this.files[0])});n("#ProductCreateModal").on("hidden.bs.modal",function(){n("#ProductCreateModal #imagePreview").attr("src","#").hide();n("#ProductCreateModal #imgProduct").val("")});r.validate({rules:{NameProduct:{required:!0,maxlength:64,minlength:2},Price:{required:!0,number:!0},DescriptionProduct:{required:!0,maxlength:256},CreationDate:{required:!0},ExpirationDate:{required:!0},CategoryIds:{required:!0},ProductImagePath:{required:!0}},messages:{NameProduct:{required:"Bạn phải nhập tên sản phẩm!",maxlength:"Tên sản phẩm không quá 64 ký tự!",minlegth:"Tên sản phẩm phải lớn hơn {0} ký tự!"},Price:{required:"Bạn phải nhập giá của sản phẩm!",number:"Giá sản phẩm phải là số!"},DescriptionProduct:{required:"Hãy nhập mô tả của sản phẩm!",maxlength:"Mô tả không quá 256 kí tự!"},CreationDate:{required:"Bạn hãy nhập ngày sản xuất!"},ExpirationDate:{required:"Bạn hãy nhập ngày hết hạn!"},NameCategory:{required:"Hãy chọn Loại sản phẩm!"},ProductImagePath:{required:"Chọn ảnh điiiiiii!"}}})})(jQuery);