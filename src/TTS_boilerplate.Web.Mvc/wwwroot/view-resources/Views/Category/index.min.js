(function(n){function o(n,i){abp.message.confirm(abp.utils.formatString("Bạn có chắc muốn xóa "+i),null,i=>{i&&u.deleteCategory(n).done(()=>{abp.notify.info(f("SuccessfullyDeleted")),t.ajax.reload()})})}var t;console.log("-- index.js Category loaded");var u=abp.services.app.category,f=abp.localization.getSource("TTS_boilerplate"),e=n("#CategoryTable"),r=n("#CategoryCreateModal"),i=r.find("form");console.log("-- property category",u);t=e.DataTable({paging:!0,serverSide:!0,ordering:!0,listAction:{ajaxFunction:u.getAllCategory,inputFilter:function(){var i={},n=t?t.order():"";if(console.log("-- order",n),n&&n.length>0){var r=n[0][0],u=n[0][1],f=t?t.settings()[0].aoColumns[r].name:1;i.sorting=f+" "+u}else i.sorting="";return console.log("-- Form data:",i),i}},buttons:[{name:"refresh",text:'<i class="fas fa-redo-alt"><\/i>',action:()=>t.draw(!1)}],responsive:{details:{type:"column"}},columnDefs:[{targets:0,className:"control",defaultContent:""},{targets:1,data:"id",name:"Id",sortable:!0,defaultContent:""},{targets:2,data:"nameCategory",name:"NameCategory",sortable:!0,defaultContent:""},{targets:3,data:"totalProduct",name:"TotalProduct",sortable:!0,defaultContent:""},{targets:4,data:null,sortable:!1,autoWidth:!1,defaultContent:"",render:(n,t,i)=>(console.log(i),[abp.auth.hasPermission("Pages.Categories_U")?`<button type="button" title="Update" class="btn btn-sm bg-secondary update-category " data-category-id="${i.id}" data-toggle="modal" data-target="#ProductEditModal">
                               <i class="fas fa-pencil-alt"></i>
                             </button>`:"",abp.auth.hasPermission("Pages.Categories_D")?`<button type="button" title="Delete" class="btn btn-sm bg-danger ml-2 delete-category" data-category-id="${i.id}" data-category-name="${i.nameCategory}" >
                                   <i class="fas fa-trash"></i> 
                                </button>`:""].join(""))}]});i.find(".save-button").on("click",n=>{if(n.preventDefault(),i.valid()){var e=i.serializeFormToObject();console.info("category_create form",e);u.createCategory(e).done(function(){r.modal("hide");i[0].reset();abp.notify.info(f("SavedSuccessfully"));t.ajax.reload()}).always(function(){abp.ui.clearBusy(r)}).fail(function(n){console.log("catch",n)})}});n(document).on("click",".update-category",function(t){var i=n(this).attr("data-category-id");console.log("--id category",i);t.preventDefault();console.log("-- path",abp.appPath+"Category/UpdateCategory?categoryId="+i);abp.ajax({url:abp.appPath+"Category/UpdateCategory?categoryId="+i,type:"POST",dataType:"html",success:function(t){if(!t||t.trim()===""){console.error("Lỗi nội dung trả về trống...");return}var i=n("#CategoryUpdateModal div.modal-content");i.length?i.html(t):console.error("Không tìm thấy modal-content");console.log("Sau html(content","--");n("#CategoryUpdateModal").modal("show");console.log("Sau show modal","--")},error:function(n){console.log("error update",n)}})});abp.event.on("category.updateModalSaved",()=>{t.ajax.reload()});n(document).on("click",".delete-category",function(){console.warn("-- Ban vua bam Delete");var t=n(this).attr("data-category-id"),i=n(this).attr("data-category-name");console.log("-- id, name category",t,i);o(t,i)});r.on("shown.bs.modal",()=>{console.warn("focus input form"),r.find("input:not([type=hidden]):first").focus()}).on("hidden.bs.modal",()=>{i.clearForm(),console.warn("out input form")});i.validate({rules:{NameCategory:{required:!0,maxlength:64}},messages:{NameCategory:{required:"Vui lòng nhập tên loại!",maxlength:"Tên loại không quá 64 ký tự"}}})})(jQuery);